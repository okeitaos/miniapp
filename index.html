<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โปรดรอสักครู่</title>
  <meta property="og:title" content="โปรดรอสักครู่">
  <meta property="og:type" content="website">
  <meta property="og:description" content="MINI App Dynamic link Keyword">
  <meta property="og:url" content="https://botstickerlth.iton5.com">
  <meta property="og:site_name" content="MINI App Dynamic link Keyword">
  <meta property="og:image" content="https://lh3.googleusercontent.com/d/1Ck_OCfEW4dEp3A1k9yfQplYmW7qmwzFF">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
   <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&display=swap');
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Prompt', sans-serif;
            background-color: #121212; 
            color: #E0E0E0; 
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }

        .container {
            background-color: #1E1E1E;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 320px;
        }

        .loader {
            border: 4px solid #444; 
            border-top: 4px solid #FFD60A;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px auto;
        }

        #status-message {
            font-size: 1.1em;
            line-height: 1.5;
            min-height: 40px;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="loader" id="loader"></div>
        <h2 id="status-message">กำลังเตรียมข้อมูล...</h2>
    </div>
    <script>
        const LIFF_ID = "2007932933";                       
        const SUPABASE_URL = "https://unsyhinckpixxrsphhcl.supabase.co";            
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVuc3loaW5ja3BpeHhyc3BoaGNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwNDE1OTQsImV4cCI6MjA2OTYxNzU5NH0.XJi84rpCAO537ihJjJgig-dgNkmTFzSPUZtGlt7BRV8";  

        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const statusMessage = document.getElementById('status-message');
        const loader = document.getElementById('loader');

        async function main() {
            try {
                await liff.init({ liffId: LIFF_ID,
                    withLoginOnExternalBrowser: true });
                const urlParams = new URLSearchParams(window.location.search);
                const keyword = urlParams.get('key');

                if (!keyword) {
                    loader.style.display = 'none'; 
                    statusMessage.textContent = "ไม่พบ 'key' ใน URL";
                    return;
                }
                await findAndRedirect(keyword);
            } catch (error) {
                console.error('LIFF or Main process failed', error);
                loader.style.display = 'none'; 
                statusMessage.textContent = "เกิดข้อผิดพลาดในการเริ่มต้น";
            }
        }

        async function findAndRedirect(keyword) {
            try {
                loader.style.display = 'block'; 
                statusMessage.textContent = `กำลังค้นหา: ${keyword}...`;

                const { data, error } = await supabaseClient
                    .from('redirects')
                    .select('redirect_url')
                    .eq('keyword', keyword)
                    .single();

                if (error) { throw error; }

                if (data && data.redirect_url) {
                    statusMessage.textContent = "กำลังดำเนินการเปิด...";

                     window.location.href = data.redirect_url;
                   

                } else {
                    loader.style.display = 'none'; 
                    statusMessage.textContent = `ไม่พบข้อมูลสำหรับคีย์ "${keyword}"`;
                }
            } catch (err) {
                console.error('Supabase query failed:', err);
                loader.style.display = 'none'; 
                statusMessage.textContent = "ไม่สามารถเชื่อมต่อฐานข้อมูลได้";
                Swal.fire('Oh!', "ไม่สามารถเชื่อมต่อฐานข้อมูลได้", 'error').then(()=>{
                 liff.closeWindow();
                })
            }
        }

        main();
    </script>
</body>
</html>
